# 服务器配置（WAR包部署时，端口由阿里云Tomcat指定，本地仅用于测试）
server:
  port: 8088
  servlet:
    context-path: /newspaper-api
    multipart:
      max-file-size: 15MB # 单个图片最大15MB
      max-request-size: 30MB # 单次请求最大30MB

# Spring 核心配置
spring:
  # 数据库配置（阿里云服务器MariaDB，需修改为实际地址/用户名/密码）
  datasource:
    url: jdbc:mariadb://localhost:3306/newspaper_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&allowMultiQueries=true&useSSL=false
    username: root # 阿里云数据库用户名
    password: 123456 # 阿里云数据库密码
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000

  # Redis配置（阿里云服务器Redis，需开放6379端口）
  redis:
    host: localhost
    port: 6379
    password: # 阿里云Redis密码（无密码则留空）
    database: 0
    timeout: 3000
    jedis:
      pool:
        max-active: 10
        max-idle: 5
        min-idle: 2

# MyBatis 配置
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.yqbtv.newspaper.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    default-fetch-size: 100
    default-statement-timeout: 30

# 自定义配置（核心：阿里云文件路径+Netty+receiverId）
custom:
  # Netty WebSocket 配置（独立端口8081，阿里云需开放该端口）
  netty:
    websocket:
      port: 8081
      boss-thread-count: 1
      worker-thread-count: 16
      max-frame-length: 1048576
      idle-timeout: 600

  # 文件上传配置（核心：阿里云服务器指定路径 /mnt/fjw/vsftpd/images/）
  file:
    upload:
      base-path: /mnt/fjw/vsftpd/images/ # 阿里云图片存储根目录（关键修改，绝对路径）
      temp-path: /mnt/fjw/vsftpd/images/temp/ # 阿里云临时文件目录（自动创建）
      allowed-image-types: jpg,png,jpeg,bmp,gif # 允许上传的图片格式
      compress:
        enable: true # 开启图片压缩
        width: 1200 # 压缩后最大宽度（高度等比例缩放）
        quality: 0.8 # 压缩质量（0.1-1.0，0.8兼顾清晰度和大小）
        suffix: _compress # 压缩文件后缀（如 test_compress.jpg）

  # receiverId 会话配置（闭环流转支撑，无修改）
  session:
    expire-seconds: 86400 # 24小时过期
    id-generate: prefix
    user-prefix: user_
    cs-prefix: cs_
    system-prefix: system_
    session-key-prefix: session:
    offline-msg-key-prefix: offline_msg:
    cs-online-key-prefix: cs_online:

# 日志配置（阿里云服务器日志输出路径，便于排查问题）
logging:
  level:
    com.yqbtv.newspaper: INFO
    org.springframework: WARN
    io.netty: WARN
  file:
    name: /mnt/fjw/vsftpd/images/logs/newspaper.log # 阿里云日志存储路径（自动创建）